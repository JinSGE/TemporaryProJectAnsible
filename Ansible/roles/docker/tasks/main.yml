# =================================================================
# Docker Engine ì„¤ì¹˜ í”„ë¡œì„¸ìŠ¤
# [Physical Architecture: VMware ë‚´ë¶€ 5ëŒ€ ì„œë²„ì˜ ê³µí†µ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ êµ¬ì¶•]
# =================================================================

- name: 1. Docker ê³µì‹ ë¦¬í¬ì§€í† ë¦¬ ì¶”ê°€
  # [Logical Architecture: ì•ˆì •ì ì¸ ì™¸ë¶€ íŒ¨í‚¤ì§€ API ì†ŒìŠ¤ í™•ë³´]
  # - ì •ì‹ GPG í‚¤ê°€ í¬í•¨ëœ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë³´ì•ˆìƒ ì•ˆì „í•œ ì„¤ì¹˜ë¥¼ ë³´ì¥.
  ansible.builtin.get_url:
    url: https://download.docker.com/linux/centos/docker-ce.repo
    dest: /etc/yum.repos.d/docker-ce.repo
    mode: '0644' # ì„¤ì • íŒŒì¼ì˜ ê¶Œí•œì„ ëª…ì‹œí•˜ì—¬ ë³´ì•ˆ ì¶©ëŒ ë°©ì§€

- name: 2. Docker ì—”ì§„ ë° ìœ í‹¸ë¦¬í‹° íŒ¨í‚¤ì§€ ì„¤ì¹˜
  # [Logical Architecture: ë°ì´í„° ì²˜ë¦¬ ë° API ëª¨ë“ˆ êµ¬ë™ì„ ìœ„í•œ ì¸í”„ë¼ ì¤€ë¹„]
  # - docker-ce: ì»¨í…Œì´ë„ˆ ì—”ì§„ í•µì‹¬
  # - containerd.io: ì¿ ë²„ë„¤í‹°ìŠ¤(v1.28.x)ì™€ í˜¸í™˜ë˜ëŠ” í‘œì¤€ ëŸ°íƒ€ì„
  # - docker-compose-plugin: í•˜ì´ë¸Œë¦¬ë“œ í´ë¼ìš°ë“œ í™˜ê²½ì˜ ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ë„êµ¬
  ansible.builtin.dnf:
    name: 
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - docker-compose-plugin
    state: present
    update_cache: yes # ìµœì‹  ì¸ë±ìŠ¤ ë°˜ì˜ìœ¼ë¡œ ë²„ì „ ë¯¸ìŠ¤ë§¤ì¹˜ ë°©ì§€

- name: 3. Docker ì„œë¹„ìŠ¤ í™œì„±í™” ë° ì‹œì‘ (Systemd)
  # [Physical Architecture: ì„œë²„ ì¬ë¶€íŒ… ì‹œì—ë„ ì»¨í…Œì´ë„ˆ í™˜ê²½ ìë™ ë³µêµ¬ ë³´ì¥]
  # - state: started (í˜„ì¬ ê°€ë™) / enabled: yes (ë¶€íŒ… ì‹œ ìë™ ì‹œì‘)
  ansible.builtin.service:
    name: docker
    state: started
    enabled: yes

# =================================================================
# ğŸ’¡ ì¶”ê°€ ë³´ì™„ ì‚¬í•­ (ì¶©ëŒ ë°©ì§€ ë¡œì§)
# ì´ ë¶€ë¶„ì€ íŠ¹ì • ì‚¬ìš©ìë¥¼ dockerë¼ëŠ” ê·¸ë£¹ì•ˆì— ë„£ì—ˆì„ ë•Œë§Œ, ì‘ë™ ê³ ë ¤.
# =================================================================
# - name: 4. Docker ì‚¬ìš©ì ê·¸ë£¹ ê¶Œí•œ ë¶€ì—¬ (ì„ íƒ ì‚¬í•­)
#   # - root ê¶Œí•œ ì—†ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì—¬ ìš´ì˜ ê¶Œí•œ ì¶©ëŒì„ ìµœì†Œí™”.
#   ansible.builtin.user:
#     name: "{{ ansible_user | default('root') }}"
#     groups: docker
#     append: yes