# =================================================================
# API ê³„ì¸µ ë°°í¬ (Left Layer)
# [Logical Architecture: ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ ë° í´ë¼ì´ì–¸íŠ¸ ì ‘ì  êµ¬ì¶•]
# =================================================================
- name: 1. API ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (Weather API)
  # [Physical Architecture: VMware PC3 ì„œë²„ ë‚´ ê²©ë¦¬ëœ í™˜ê²½ ì œê³µ]
  community.docker.docker_container:
    name: weather-api
    image: fastapi-weather:latest
    state: started
    restart_policy: always
    published_ports: 
      - "8001:8000"
    # ğŸ’¡ ì˜ë„: ê¸°ìƒ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì¤‘ì•™ ë°ì´í„° ì²˜ë¦¬ ëª¨ë“ˆë¡œ ì „ë‹¬í•˜ëŠ” ì…êµ¬ ì—­í• 

- name: 2. API ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (Logistics API)
  community.docker.docker_container:
    name: logistics-api
    image: fastapi-logistics:latest
    state: started
    restart_policy: always
    published_ports: 
      - "8002:8000"
    # ğŸ’¡ ì˜ë„: ë¬¼ë¥˜ íë¦„ ë°ì´í„°ë¥¼ APIë¥¼ í†µí•´ ì¸ë²¤í† ë¦¬ ì‹œìŠ¤í…œê³¼ ë™ê¸°í™”

- name: 3. API ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (Energy API)
  community.docker.docker_container:
    name: energy-api
    image: fastapi-energy:latest
    state: started
    restart_policy: always
    published_ports: 
      - "8003:8000"
    # ğŸ’¡ ì˜ë„: ì—ë„ˆì§€ ì†Œë¹„ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ AI ë¶„ì„ ëª¨ë“ˆì˜ ê¸°ì´ˆ ìë£Œ ì œê³µ

# =================================================================
# API ê³„ì¸µ ì¼ê´„ ë°°í¬ (Role ê¸°ë°˜ ìµœì í™”) - ë³€ìˆ˜ ì‚¬ìš©í•  ê²½ìš° -> ë‹¤ì¤‘ ì¼ê´„ ì‚¬ìš©.
# [Logical Architecture: API -> ë°ì´í„° ì²˜ë¦¬ íë¦„ì˜ í™•ì¥ì„± í™•ë³´]
# =================================================================
# - name: API ì»¨í…Œì´ë„ˆë“¤ì„ ì¼ê´„ ì‹¤í–‰í•©ë‹ˆë‹¤ (Loop ë°©ì‹)
#   # [Physical Architecture: 5ëŒ€ ì„œë²„ í™˜ê²½ì—ì„œ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì  ë°°ë¶„]
#   community.docker.docker_container:
#     name: "{{ item.name }}"
#     image: "{{ item.image }}"
#     state: started
#     restart_policy: always
#     published_ports:
#       - "{{ item.host_port }}:{{ api_internal_port | default('8000') }}"
#   # host_vars ë˜ëŠ” group_varsì— ì •ì˜ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©° ì‹¤í–‰.
#   loop: "{{ deploy_apis }}"
#   # ğŸ’¡ ì¥ì : ìƒˆë¡œìš´ API ì¶”ê°€ ì‹œ ì´ Taskë¥¼ ìˆ˜ì •í•  í•„ìš” ì—†ì´ ë³€ìˆ˜ íŒŒì¼ë§Œ ì—…ë°ì´íŠ¸.

###############################################################
# API ì´ë¯¸ì§€ ë¡œì»¬ í´ë” ì•ˆì—ì„œ ë¡œë“œí•˜ëŠ” ê²½ìš°
# [Logical Architecture: API ëª¨ë“ˆì„ ì´ë¯¸ì§€ í˜•íƒœë¡œ êµ¬ì²´í™”]
# - name: 1. API ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
#   ansible.builtin.copy:
#     src: ./weather_api_source/  # ë‚´ ë¡œì»¬ì˜ ì†ŒìŠ¤ ê²½ë¡œ
#     dest: /opt/weather-api/     # ì„œë²„ì˜ ì €ì¥ ê²½ë¡œ

# - name: 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ (Dockerfile ê¸°ì¤€)
#   community.docker.docker_image:
#     name: fastapi-weather
#     tag: latest
#     build:
#       path: /opt/weather-api/   # Dockerfileì´ ìˆëŠ” ê²½ë¡œ
#     source: build
###############################################################

# =================================================================
# API ë°°í¬ ì „ ì´ë¯¸ì§€ ì¤€ë¹„ ë‹¨ê³„
# =================================================================

# - name: [ì´ë¯¸ì§€ í™•ë³´] API ì†ŒìŠ¤ ê¸°ë°˜ ì´ë¯¸ì§€ ë¹Œë“œ
#   community.docker.docker_image:
#     name: "{{ item.image_name }}"
#     build:
#       path: "{{ item.source_path }}"
#     source: build
#   loop:
#     - { image_name: 'fastapi-weather', source_path: '/opt/api/weather' }
#     - { image_name: 'fastapi-logistics', source_path: '/opt/api/logistics' }

# - name: [ë°°í¬] ì¤€ë¹„ëœ ì´ë¯¸ì§€ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰
#   community.docker.docker_container:
#     name: "{{ item.name }}"
#     image: "{{ item.image_name }}:latest"
#     state: started
#     published_ports: "{{ item.port }}"
#   loop:
#     - { name: 'weather-api', image_name: 'fastapi-weather', port: '8001:8000' }
# =================================================================